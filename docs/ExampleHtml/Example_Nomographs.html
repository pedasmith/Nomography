<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Nomograms from "Elements of Nomography" (1947)</title>
    <!-- make this an "installable"  progressive web app (PWA) -->
    <link rel="manifest" href="manifest.webmanifest" />
    <link rel="stylesheet" href="Nomograph.css">
    <script src="Nomograph_Ticks.js" ></script>
    <script src="Nomograph_Scale.js" ></script>
    <script src="Nomograph.js" ></script>
    <script src="Elements_of_Nomography_1947_Examples.js" ></script>
    <script>
        let nomograph = null;

        function qround(y) { return Math.round(y*10) / 10; }
        function OnExampleChanged(value)
        {
            var item = Examples[value];
            document.getElementById("uiHeader").innerText = item.Title;
            document.getElementById("uiDetails").innerText = item.Details;
            let svg = document.getElementById("nomo");
            nomograph = item.Create(svg);

            nomograph.AddValueChangedListener((event) => 
            {
                const change = event.detail.change;
                const current = event.detail.current;
                //console.log(`NOTE: delta: U=${qround(current.valueU)} V=${qround(current.valueV)} W=${qround(current.valueW)} Pixel U=${qround(current.valueUPixel)} V=${qround(current.valueVPixel)} W=${qround(current.valueWPixel)}` );

                document.getElementById("uiValueU").innerText = qround(current.valueU);
                document.getElementById("uiValueV").innerText = qround(current.valueV);
                document.getElementById("uiValueW").innerText = qround(current.valueW);

            });
        }
        function OnBodyLoad()
        {
            const s = document.getElementById("uiExample");
            var lastkey = "";
            for (const [key, value] of Object.entries(Examples)) {
                const option = new Option(value.Short, key);
                lastkey = key;
                s.add(option);
            }
            s.value = lastkey;
            s.dispatchEvent(new Event("change"));

            // Connect up the uiValues
        }        
    </script>
</head>
<body onload="OnBodyLoad()">
    <div class="box">
        <header class="row header">
            <h1 id="uiHeader"></h1>
            <p id="uiDetails"></p>

        </header>
        <div class="row content">
            <svg height="100%" width="400" id="nomo" />
        </div>
        <div class="row footer">
            <!-- This will eventually be an editor...
            <form>
                <input id="idMin" value="5">
            </form>
        -->
            <div id="uiValues">
                U=<span id="uiValueU"></span>
                V=<span id="uiValueV"></span>
                W=<span id="uiValueW"></span>
            </div>
            <form>
                <label for="uiExample">Pick a Nomograph to create</label>
                <select id="uiExample" onchange="OnExampleChanged(this.value)">
                    <!-- select box is filled in as part of the OnLoad -->
                </select>
            </form>
            <div>
                The Nomograph page lets you view and interact with different pre-created nomographs.
            </div>
        </div>
    </div>
</body>
</html>
